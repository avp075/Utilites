
# Define variables
SONARQUBE_URL="http://your-sonarqube-url"
SONARQUBE_TOKEN="your-sonarqube-token"
TEMPLATE_NAME="your-template-name"
PROJECT_KEY_PATTERN="your-project-key-pattern"  # e.g., "my-project-*"

# Check if the permission template already exists with debug enabled
curl -v -u $SONARQUBE_TOKEN: \
     "$SONARQUBE_URL/api/permissions/search_templates?templateName=$TEMPLATE_NAME" \
     | grep -q "\"name\":\"$TEMPLATE_NAME\""

# If the template does not exist, create it with debug enabled
if [ $? -ne 0 ]; then
  curl -v -u $SONARQUBE_TOKEN: -X POST \
       "$SONARQUBE_URL/api/permissions/create_template" \
       -d "name=$TEMPLATE_NAME" \
       -d "description=Description of your template" \
       -d "projectKeyPattern=$PROJECT_KEY_PATTERN"
else
  echo "Template '$TEMPLATE_NAME' already exists."
fi
